<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            corePlugins: { preflight: false }
        };
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="color-scheme" content="light dark">
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/offline-exporting.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <title>{% block title %}newsletterr{% endblock %}</title>
</head>
<body>
    <div id="spinner" class="spinner" style="display: none;">
        <img src="/static/img/load.gif" alt="Loading..." />
        <p id="loading-text"></p>
    </div>
    <nav class="navbar">
        <ul id="navLinks">
            <li><a href="{{ url_for('index') }}" class="hover:underline">newsletterr</a></li>
            <li><a href="{{ url_for('email_history') }}" class="hover:underline">email history</a></li>
            <li><a href="{{ url_for('scheduling') }}" class="hover:underline">scheduling</a></li>
            <li><a href="{{ url_for('settings') }}" class="hover:underline">settings</a></li>
            <li><a href="{{ url_for('about') }}" class="hover:underline">about</a></li>
            <!-- Cache Status Indicator -->
            <li style="margin-left: 20px;">
                {% set cache_status = get_cache_status() %}
                <span class="cache-status-badge {{ cache_status.class }}" 
                      title="{{ cache_status.status }}">
                    <i class="fas fa-database"></i>
                    {% if cache_status.has_data %}
                        {{ cache_status.age_display }}
                    {% else %}
                        no data
                    {% endif %}
                </span>
            </li>
        </ul>
        {% if update_info.is_newer %}
            <div style="
                position: sticky; top: 0; z-index: 1000;
                background: #fff3cd; color: #664d03; border: 1px solid #ffecb5;
                padding: 10px 14px; font-size: 14px;">
                A new version {{ update_info.latest }} is available.
                <a href="{{ update_info.release_url }}" target="_blank" rel="noopener">See release notes</a>
            </div>
        {% endif %}
        <div style="display: flex; align-items: center; gap: 10px;">
            <button id="theme-toggle" type="button" role="switch" aria-checked="false" aria-label="Toggle dark mode" class="relative inline-flex h-8 w-16 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors focus:outline-none transform -translate-x-2 translate-y-2.5">
                <span class="pointer-events-none absolute inset-0 z-20 flex items-center justify-between px-1">
                    <!-- Sun icon for light mode -->
                    <svg class="h-6 w-6 text-orange-500 transition-opacity duration-200 ease-in-out dark:!opacity-0 transform translate-x-0.5 translate-y-0" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2">
                            <path d="M12 1V3" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M19.07 4.93L17.66 6.34" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M23 12H21" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M19.07 19.07L17.66 17.66" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M12 23V21" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M4.93 19.07L6.34 17.66" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M1 12H3" stroke-width="2" stroke-linecap="round"></path>
                            <path d="M4.93 4.93L6.34 6.34" stroke-width="2" stroke-linecap="round"></path>
                            <circle cx="12" cy="12" r="4" stroke-width="2"></circle>
                        </g>
                    </svg>
                    <!-- Moon icon for dark mode -->
                    <svg class="h-6 w-6 text-slate-800 transition-opacity duration-200 ease-in-out opacity-0 dark:!opacity-100 transform -translate-x-0.5 translate-y-0" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" style="filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="1" fill="currentColor"/>
                    </svg>
                </span>
                <span class="absolute z-10 inline-block h-6 w-6 rounded-full bg-white shadow-lg transform transition-all duration-200 will-change-transform translate-x-1 dark:translate-x-8 dark:bg-gray-800"></span>
            </button>
            <img src="/static/img/Asset_94x.png" alt="Logo" class="logo" />
        </div>
    </nav>
    {% block content %}{% endblock %}
    <script>
        function showSpinner(passedText) {
            document.getElementById('spinner').style.display = 'flex';
            document.getElementById('loading-text').innerText = passedText;
        }

        function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
        }
    </script>
    <script>
        (function initTheme() {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.classList.toggle('dark', saved ? saved === 'dark' : prefersDark);
        })();

        const btn = document.getElementById('theme-toggle');
        function syncAria() {
            btn?.setAttribute('aria-checked', document.documentElement.classList.contains('dark'));
        }
        syncAria();

        btn?.addEventListener('click', () => {
            const root = document.documentElement;
            const isDark = root.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            syncAria();
            updatePreview();
        });
    </script>
</body>
<footer>
    <p class="left-foot">
        Newsletterr Â© 2025. <a target="_blank" href="https://discord.gg/7Skcsqs4uT">Join the discussion on Discord!</a>
    </p>
    <p class="right-foot">
        {{ version }}
        <a target="_blank" href="https://github.com/jma1ice/newsletterr">GitHub</a>
    </p>
</footer>
</html>
