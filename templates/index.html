{% extends "base.html" %}
{% block title %}newsletterr{% endblock %}
{% block content %}
    <div class="background">
        <h1>Dashboard</h1><br>
        {% if alert %}
            <h3>{{ alert }}</h3>
        {% endif %}
        <div class="foreground">
            <h2>A</h2><br>
            <div>
                <form method="POST" action="/send_email">
                    From: <input type="email" name="from_email" placeholder="Your Email" required><br><br>
                    Password: <input type="password" name="password" placeholder="Email Password or App Password" required><br><br>
                    SMTP Server: <input type="text" name="smtp_server" placeholder="SMTP Server (e.g. smtp.gmail.com)" required><br><br>
                    SMTP Port: <input type="number" name="smtp_port" placeholder="SMTP Port (465 for SSL)" required><br><br>
                    To: <input type="email" name="to_email" placeholder="Recipient Email" required><br><br>
                    Subject: <input type="text" name="subject" placeholder="Subject" required><br><br>
                    <label for="layout">Choose a layout:</label>
                    <select id="layout" name="layout" onchange="updatePreview()">
                        <option value="none">Plain Text</option>
                        <option value="basic">Basic</option>
                        <option value="card">Centered Card</option>
                        <option value="dark">Dark Mode Box</option>
                        <option value="twocol">Two-column</option>
                        <option value="banner">Banner/Header</option>
                    </select><br><br>
                    <textarea name="email_text" id="email_text" placeholder="Write your message..." rows="10" cols="50" oninput="updatePreview()" required></textarea>
                    
                    Preview: <iframe class="right_frame" id="preview"></iframe><br>

                    <input type="submit" value="Send Email">
                </form>
            </div>
            <script>
                function updatePreview() {
                    const raw = document.getElementById('email_text').value;
                    const layout = document.getElementById('layout').value;
                    let body = raw.replace(/\n/g, "<br>");
                    let html = "";
                
                    switch (layout) {
                        case "basic":
                            html = `
                                <html><body style="font-family: Arial; padding: 20px;">
                                <h2>newsletterr</h2>
                                <div style="border: 1px solid #ddd; padding: 10px; background: #f9f9f9;">
                                    ${body}
                                </div></body></html>`;
                            break;
                        case "card":
                            html = `
                                <html><body style="background: #f0f0f0; display: flex; justify-content: center; font-family: Arial;">
                                <div style="background: white; max-width: 600px; padding: 20px; margin: 40px auto; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
                                    ${body}
                                </div></body></html>`;
                            break;
                        case "dark":
                            html = `
                                <html><body style="background: #111; color: #eee; font-family: Arial; padding: 20px;">
                                <div style="background: #222; padding: 20px; border-radius: 8px;">
                                    ${body}
                                </div></body></html>`;
                            break;
                        case "twocol":
                            html = `
                                <html><body style="font-family: Arial; padding: 20px;">
                                <table style="width: 100%;">
                                <tr>
                                    <td style="width: 50%; padding: 10px;">
                                    <img src="https://d15k2d11r6t6rl.cloudfront.net/public/users/Integrators/669d5713-9b6a-46bb-bd7e-c542cff6dd6a/3bef3c50f13f4320a9e31b8be79c6ad2/Plex%20Logo%20Update%202022/plex-logo-heavy-stroke.png" style="max-width: 100%;">
                                    </td>
                                    <td style="width: 50%; padding: 10px;">${body}</td>
                                </tr>
                                </table></body></html>`;
                            break;
                        case "banner":
                            html = `
                                <html><body style="font-family: Arial;">
                                <div style="background: #0077cc; color: white; padding: 20px; text-align: center;">
                                <h1>newsletterr</h1>
                                </div>
                                <div style="padding: 20px;">${body}</div></body></html>`;
                            break;
                        default:
                            html = `<html><body>${body}</body></html>`;
                    }
                
                    document.getElementById('preview').srcdoc = html;
                }
                
                document.addEventListener('DOMContentLoaded', () => {
                    document.getElementById('email_text').addEventListener('input', updatePreview);
                });
            </script>
        </div><br>
        <div class="foreground">
            <h2>B</h2>
        </div>
    </div>
{% endblock %}
